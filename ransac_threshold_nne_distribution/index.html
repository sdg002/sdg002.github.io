<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>

    <title>Using the mean nearest neighbour distance to arrive at RANSAC threshold computation</title>
    <meta http-equiv="refresh" content="5">
    <style>
        body {
            font-family: Arial
        }

        img.examples {
            /*width:200px;height:200px;border-width:1px;border-style:solid;*/
        }
    </style>
    <script src="../auto-refresh.js"></script>
</head>

<body>

    <header>
        <h1>
            Nearest neighbour distance metric approach to determine the RANSAC threshold
        </h1>

    </header>
    <h2>
        Introduction
    </h2>
    <p>
        The RANSAC algorithm is a very robust and a well established approach to determinine the straight line(s) which fit a noisy set of data points. 
        In this article I have explored the possiblity of using the Nearest Neighbour Distance statistic 
        as a means of arriving at the RANSAC threshold distance parameter
    </p>
    <u>Show an image here, noisy line on the left, RANSAC line on the right</u>
    <h2>
        What problem does the RANSAC algorithm solve?
    </h2>
    <p>
        Consider the data points below.
        We have a mix of inliers (black) and outliers (red). We want to find the model of the straight line which fits the inliers. 
        The human mind can easily distinguish the inliers from the outliers and produce a line which neatly fits all the inliers.
        <br />
        <img src="images/all_data_points.png" alt="All data points" />
        <br />
        RANSAC is a simple voting-based algorithm that iteratively samples the population of points and find the subset of those lines which appear to conform to a model. In this case, the model is a straight line.
        <img src="images/desired_line_mind.png" alt="All data points" />
        <br />
        Least squares method will encompass all points thereby producing a line which is away from the desired line
        <br />
        <img src="images/actual_line_leastsquares.png" alt="All data points" />
    </p>
    <hr />

    <h2>
        How does the RANSAC algorithm work?
    </h2>
    <p>
        This is not a detailed discussion on RANSAC. 
        <br />
        <img src="images/Wikipedia_RANSAC_Inliers_and_Outliers.png" alt="Outliers, inliers and threshold distance" />
        <br />
        Copyright information for this image can be found <a href="https://commons.wikimedia.org/w/index.php?curid=37017886">here</a>
    </p>
    <ol>
        <li>Pick any N random points from the entire population</li>
        <li>Find the line using Least Squares which fits the N points</li>
        <li>Find all points which are inliers to this new line. Inliers are points which are within threshold distance 'd' of the line</li>
        <li>Repeat the above for a configured number of trials.</li>
        <li>The line which produces the highest inliers is the winnder</li>
    </ol>
    <p>
        <br />
        Detailed working of the RANSACA can be found in this <a href="https://en.wikipedia.org/wiki/Random_sample_consensus">Wikipedia article</a> 
        and <a href="https://medium.com/mlearning-ai/outlier-detection-using-the-ransac-algorithm-de52670adb4a">my article on Medium</a> .
    </p>
    <hr />


    <h2>
        What problem are we attempting to address in this article?
    </h2>
    <p>
        How do we determine the optimum RANSAC threshold parameter 'd'? 
        <br />
        <img src="images/find_the_optimum_ransac_threshold_distance.png" alt="Determine threshold distance"/>
        <br />
        
        
    </p>
    <ul>
        <li>
            If the <strong>threshold</strong> is too large then the RANSAC algorithm will produce a line which has encompassed potential outliers. 
        </li>

        <li>
            If the <strong>threshold</strong> is too small then the RANSAC algorithm might not find anything at all.
        </li>
    </ul>
    <hr />

    <h2>
        What is the the intuition behind Nearest Neighbour Distance?
    </h2>
    <p>
        <strong>What is Nearest Neighbour Distance (NNE)?</strong><br />
        Consider the points displayed in this image. By definition, every point has 1 one point which is closest. You could have multiple points which are equidistant and hence multiple nearest neighbours. But for this discussion we will pick the closest neighbour.
        <br />
        <img src="images/nne_introduction.png" alt="NNE introduction"/>
    </p>
    <ol>
        <li>
            Point 2 is the nearest neighbour of point 1
        </li>
        <li>
            Point 2 is the nearest neighbour of point 4 and vice-versa
        </li>
        <li>
            Point 4 is the nearest neighbour of point 3
        </li>
        <li>
            Point 4 is the nearest neighbour of point 5
        </li>
    </ol>
    <img src="images/definition_average_nne.png" alt="Definition of average NNE"/>
    <p>
        <br />
        <strong>What was the inspiration for using NNE distance?</strong>
        <br />
        The NNE statistic gives us an idea of how close or spread out the data points are.
        The RANSAC threshold distance parameter must have some correlation with the mean or median NNE.
        
        <br />

    </p>
    <hr />

    <h2>
        How to calculate the the nearest neighbour distance?
    </h2>
    <p>
        scikit-learn provides the excellent class <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KDTree.html">KDTree</a>
    </p>
        <pre>
import numpy as np
rng = np.random.RandomState(0)
X = rng.random_sample((10, 3))  # 10 points in 3 dimensions
tree = KDTree(X, leaf_size=2)              
dist, ind = tree.query(X[:1], k=3)                
print(ind)  # indices of 3 closest neighbors

print(dist)  # distances to 3 closest neighbors
        </pre>


    <hr />
    
    <h2>
        Going deeper into the implementation
    </h2>
    <p>
        talk about generating salt-pepper images with various degrees of noise and lines with various max distance<br />
        show pic of salt pepper here <br />
        talk about running RANSAC algorithm , hwo to generate the threshold and talk about the factor<br />
        talk about comparing the results side by side<br />
        show pic of side by side comparison <br />
    </p>
    <h2>
        Results - When image contains a one line
    </h2>
    <p>
        Different images (SP,MAXD) vs THRESHOLD (factor * mean nne)
        <br />
        <img src="images/workinprogress.png" />
    </p>

    <h2>
        Results - When image contains two lines
    </h2>
    <p>
        Different images (SP,MAXD) vs THRESHOLD (factor * mean nne)
        <br />
        <img src="images/workinprogress.png" />
    </p>

    <h2>
        Accompanying source code
    </h2>
    <p>
        The accompanying code is divided into <strong>runnable top level files</strong> and <strong>reusable classes in inner folders</strong>:
    </p>
    <strong>Top level files</strong>
    <ol>
        <li><b>SaltPepper.py</b>-Generates noisy images with a dimensions 100X150 using the specified random salt pepper noise, one dotted line with the specified distance between consecutive points </li>
    </ol>

    <strong>Sub-folders</strong>
    <ol>
        <li>algorithm</li>
        <li>data</li>
        <li>history</li>
        <li>htmlgenerator</li>
        <li>tests</li>
    </ol>

    <h2>
        How to generate noisy images?
    </h2>
    <p>
        explain which file, what to run<br />
        explain the folder structure of the results
    </p>
    <h2>
        How to run the RANSAC algorithm?
    </h2>
    <p>
        Explain <strong>ExecuteRansac</strong>
    </p>

    <h2>
        How to display the results?
    </h2>
    <p>
        Explain <strong>PlotResultsSideBySide</strong>
        <u>Show a tiny pic of the overall HTML presentation</u>
    </p>


    <h2>Putting it all together</h2>
    <p>
        Summarize the steps in the right sequence.<br />
        Show pictures of folders getting created<br />  
        Show pictures of prompts<br />
        Show pictures of results folder getting generated <br />
        Repeat thumbnail of HTML<br />


    </p>

    <h2>Github</h2>
    <p>
        Link to github comes here
    </p>

    <h2>References</h2>
    <p>
        Provide links to important videos, e.g. RANSAC on youtube, wikipedia and some of my articles
    </p>

</body>

</html>